image: golang:1.23-alpine

stages:
  - setup
  - build

setup_environment:
  stage: setup
  script:
    - echo "Setting Go environment variables..."
    # Install git since it's missing in the golang:1.23-alpine image
    - apk add --no-cache git
    # Set GOPRIVATE to handle private Go modules
    - export GOPRIVATE=github.com/PecozQ
    # Enable Go modules
    - go env -w GO111MODULE=on
    # Set GOPRIVATE again for wildcard usage
    - go env -w GOPRIVATE=github.com/PecozQ/*
    # Use SSH instead of HTTPS for GitHub
    - git config --global url."git@github.com:".insteadof "https://github.com/"
    - echo "Environment setup complete."

build:
  stage: build
  script:
    - echo "Listing project files..."
    - ls -la
    - echo "Navigating to target directory..."
    - cd backend/applications/identity || (echo "Directory not found!" && exit 1)
    - echo "Running go mod tidy..."
    - go mod tidy
    - echo "Current directory: $(pwd)"
    - echo "Listing contents of backend/applications:"
    - ls -la ../

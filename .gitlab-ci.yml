image: golang:1.23-alpine

stages:
  - setup
  - build

setup_environment:
  stage: setup
  script:
    - echo "Setting Go environment variables..."
    - apk add --no-cache git
    - export GOPRIVATE=github.com/PecozQ
    - go env -w GO111MODULE=on
    - go env -w GOPRIVATE=github.com/PecozQ/*
    - git config --global url."git@github.com:".insteadof "https://github.com/"
    - echo "Environment setup complete."

build:
  stage: build
  script:
    - echo "Listing project files..."
    - ls -la
    - echo "Navigating to target directory..."
    - if [ ! -d backend/applications/identity ]; then echo "Directory not found!"; exit 1; fi
    - cd backend/applications/identity
    - echo "Running go mod tidy..."
    - go mod tidy
    - echo "Current directory: $(pwd)"
    - echo "Listing contents of backend/applications:"
    - ls -la ../
